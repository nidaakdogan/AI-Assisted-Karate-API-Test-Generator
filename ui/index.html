<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Karate + AI Test Panosu</title>
    <style>
      :root {
        font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
        background-color: #f5f7fb;
        color: #111827;
      }

      body {
        margin: 0;
        padding: 0;
      }

      .page {
        min-height: 100vh;
        padding: 48px 32px;
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        flex-wrap: wrap;
        gap: 16px;
      }

      .title {
        font-size: 28px;
        font-weight: 700;
        margin: 0;
        color: #003366;
      }

      .subtitle {
        font-size: 14px;
        color: #6c757d;
        margin: 4px 0 0;
      }

      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
      }

      .card {
        background-color: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
        transition: transform 150ms ease, box-shadow 150ms ease;
      }

      .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.14);
      }

      .card-label {
        font-size: 15px;
        font-weight: 600;
        color: #374151;
        margin: 0 0 8px;
      }

      .count {
        font-size: 44px;
        font-weight: 700;
        margin: 0;
      }

      .count.manual {
        color: #003366;
      }

      .count.ai {
        color: #28a745;
      }

      .status-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 14px;
        border-radius: 999px;
        font-size: 14px;
        font-weight: 600;
        border: 1px solid transparent;
      }

      .status-pill[data-status="PASS"] {
        color: #ffffff;
        background-color: #28a745;
        border-color: #28a745;
      }

      .status-pill[data-status="FAIL"] {
        color: #ffffff;
        background-color: #dc3545;
        border-color: #dc3545;
      }

      .status-pill[data-status="BİLİNMİYOR"] {
        color: #003366;
        background-color: #f8fafc;
        border-color: #cbd5f5;
      }

      .muted {
        font-size: 13px;
        color: #6c757d;
        margin-top: 12px;
      }

      footer {
        margin-top: auto;
        font-size: 12px;
        color: #94a3b8;
      }

      .error {
        background: #fff4f4;
        border: 1px solid #f5c2c7;
        color: #b42318;
        padding: 16px;
        border-radius: 12px;
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <div>
          <h1 class="title">Karate Test Durumu</h1>
          <p class="subtitle">
            Manuel ve AI üretimli senaryoları tek bakışta özetleyen mini pano.
          </p>
        </div>
      </header>

      <div id="content" class="cards" aria-live="polite"></div>

      <footer>Güncel veri için `py ui\\build_dashboard_data.py` komutunu çalıştırın.</footer>
    </div>

    <script>
      const contentEl = document.getElementById("content");

      function renderDashboard(data) {
        const { manualScenarioCount, aiScenarioCount, lastRun } = data;

        contentEl.innerHTML = `
          <article class="card" data-testid="manual-card">
            <p class="card-label">Manuel Senaryo Sayısı</p>
            <p class="count manual" data-testid="manual-count">${manualScenarioCount}</p>
            <p class="muted">Karate feature klasöründeki manuel senaryolar</p>
          </article>
          <article class="card" data-testid="ai-card">
            <p class="card-label">AI Üretimli Senaryo Sayısı</p>
            <p class="count ai" data-testid="ai-count">${aiScenarioCount}</p>
            <p class="muted">Python script'iyle otomatik üretilenler</p>
          </article>
          <article class="card" data-testid="last-run-card">
            <p class="card-label">Son Test Çalıştırması</p>
            <div class="status-pill" data-status="${lastRun.status}">
              <span>${lastRun.status}</span>
            </div>
            <p class="muted">
              PASS: ${lastRun.passCount ?? "?"} • FAIL: ${lastRun.failCount ?? "?"}
            </p>
          </article>
        `;
      }

      function renderError(message) {
        contentEl.innerHTML = `
          <div class="error">
            ${message}<br />
            <strong>Çözüm:</strong> Önce <code>py ui\\build_dashboard_data.py</code> komutunu çalıştırın.
          </div>
        `;
      }

      fetch("dashboard-data.json", { cache: "no-store" })
        .then((res) => {
          if (!res.ok) throw new Error("Veri dosyası okunamadı");
          return res.json();
        })
        .then(renderDashboard)
        .catch(() =>
          renderError("Dashboard verisi yüklenemedi. JSON dosyası eksik olabilir.")
        );
    </script>
  </body>
</html>

